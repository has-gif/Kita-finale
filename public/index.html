<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Kita-Dokumentation</title>

<style>
body{font-family:Arial;background:#f7f7f7;margin:0}
.container{max-width:900px;margin:30px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.06)}
h1,h2{color:#2c3e50}
label{display:block;margin-top:12px;font-weight:600}
input,select,textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;margin-top:6px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:700px){.grid{grid-template-columns:1fr}}
.checkbox-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
@media(max-width:700px){.checkbox-grid{grid-template-columns:repeat(2,1fr)}}
button{padding:10px 16px;border:none;border-radius:6px;background:#2f80ed;color:#fff;cursor:pointer;margin-top:10px}
button:hover{background:#1c60d6}
#gpt-output{white-space:pre-wrap;background:#eef4ff;border-left:4px solid #2f80ed;padding:12px;border-radius:6px;margin-top:16px;min-height:90px}

#loginOverlay{position:fixed;inset:0;background:#fff;z-index:9999;display:flex;align-items:center;justify-content:center}
#loginBox{padding:25px;border-radius:10px;box-shadow:0 10px 40px rgba(0,0,0,.1);width:320px;text-align:center}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginOverlay">
<div id="loginBox">
<h2>Kita-Dokumentation</h2>
<input type="password" id="pwInput" placeholder="Passwort (Kita2025)">
<button onclick="checkLogin()">Login</button>
<div id="loginMsg"></div>
</div>
</div>

<div class="container">

<h1>Dokumentation</h1>

<div class="grid">

<div>
<label>Geschlecht</label>
<select id="geschlecht">
<option value="">Bitte auswählen</option>
<option>männlich</option>
<option>weiblich</option>
</select>
</div>

<div>
<label>Alter (z.B. 4,2)</label>
<input id="alter">
</div>

<div>
<label>Betreuung</label>
<select id="gruppe">
<option value="">Bitte auswählen</option>
<option>Krippe</option>
<option>Kita</option>
</select>
</div>

<div>
<label>Pädagogische Fachkraft</label>
<input id="fachkraft">
</div>

</div>

<label>Situation</label>
<textarea id="situation"></textarea>

<label>Beobachtung</label>
<textarea id="beobachtung"></textarea>

<label>Eingewöhnung</label>
<textarea id="eingewoehnung"></textarea>

<label>Starthilfen</label>
<textarea id="starthilfen"></textarea>

<label>Empfehlung</label>
<textarea id="empfehlung"></textarea>

<label>Zielvereinbarung</label>
<textarea id="ziel"></textarea>

<h2>Bereiche</h2>

<div class="checkbox-grid">
<label><input type="checkbox" value="Sprache"> Sprache</label>
<label><input type="checkbox" value="Sozialverhalten"> Sozialverhalten</label>
<label><input type="checkbox" value="Motorik"> Motorik</label>
<label><input type="checkbox" value="Emotionale Entwicklung"> Emotionale Entwicklung</label>
<label><input type="checkbox" value="Selbstständigkeit"> Selbstständigkeit</label>
<label><input type="checkbox" value="Sauberkeitsentwicklung"> Sauberkeitsentwicklung</label>
<label><input type="checkbox" value="Ressourcen und besondere Stärken"> Ressourcen & Stärken</label>
<label><input type="checkbox" value="Unterstützungsbedürftige Bereiche"> Unterstützungsbedarf</label>
</div>

<br>

<button onclick="generateText()">GPT-Dokumentation generieren</button>
<button onclick="exportPDF()">Als PDF speichern</button>
<button onclick="exportWord()">Export zu Word</button>

<div id="gpt-output">Hier erscheint die generierte Beobachtung…</div>

</div>

<script>

/* LOGIN */
function checkLogin(){
 if(pwInput.value==="Kita2025"){
  loginOverlay.style.display="none";
 }else{
  loginMsg.innerText="Falsches Passwort";
 }
}

/* PROMPT */
function buildPrompt(){

const bereiche=[...document.querySelectorAll("input[type=checkbox]:checked")]
.map(e=>e.value).join(", ");

const alterRaw=alter.value||"";
let altersHinweis="";

const alterNum=parseFloat(alterRaw.replace(",","."))

if(!isNaN(alterNum)){
 if(alterNum<3) altersHinweis="U3-Kind: besonders behutsam formulieren.";
 else if(alterNum<5) altersHinweis="Kindergartenalter: altersangemessen formulieren.";
 else altersHinweis="Vorschulalter: Fokus auf Selbstständigkeit.";
}

return `
Du bist eine pädagogische Fachkraft.

WICHTIG:
Nutze nur die angegebenen Beobachtungen.
Erfinde keine Inhalte.

Vermutungen nur, wenn sie logisch ableitbar sind.
Kennzeichne mit: möglicherweise, es könnte sein.

Keine Diagnosen. Keine Defizitsprache.

${altersHinweis}

Wenn der Bereich "Ressourcen und besondere Stärken" gewählt wurde,
formuliere ausschließlich ressourcenorientiert und wertschätzend.

Rahmendaten:
Geschlecht: ${geschlecht.value}
Alter: ${alterRaw}
Betreuung: ${gruppe.value}
Fachkraft: ${fachkraft.value}

Situation:
${situation.value}

Beobachtungen:
${beobachtung.value}

Eingewöhnung:
${eingewoehnung.value}

Starthilfen:
${starthilfen.value}

Empfehlungen:
${empfehlung.value}

Ziel:
${ziel.value}

Bereiche:
${bereiche}

Strukturiere den Text mit Überschriften.
`;
}

/* GPT */
async function generateText(){

const out=document.getElementById("gpt-output");
out.innerText="⏳ Generiere..."

try{

const res=await fetch("/api/chat",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({prompt:buildPrompt()})
})

const data=await res.json()
out.innerText=data.content||"Keine Antwort"

}catch{
 out.innerText="Serverfehler"
}
}

/* PDF */
function exportPDF(){

const text=document.getElementById("gpt-output").innerText;

const win=window.open("","","width=900,height=700");

win.document.write(`
<html>
<head>
<title>Kita-Dokumentation</title>
<style>
body{font-family:Arial;padding:40px}
h1{text-align:center}
</style>
</head>
<body>

<h1>Kita-Dokumentation</h1>

<pre>${text}</pre>

</body>
</html>
`);

win.document.close();
win.focus();
win.print();
}

/* WORD */
async function exportWord(){

const data={
 geschlecht:geschlecht.value,
 alter:alter.value,
 gruppe:gruppe.value,
 fachkraft:fachkraft.value,
 situation:situation.value,
 beobachtung:beobachtung.value,
 eingewoehnung:eingewoehnung.value,
 starthilfen:starthilfen.value,
 empfehlung:empfehlung.value,
 ziel:ziel.value,
 text:document.getElementById("gpt-output").innerText
};

try{

const res=await fetch("/api/export",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify(data)
})

const blob=await res.blob();

const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="kita_dokumentation.docx";
a.click();

}catch{
 alert("Export fehlgeschlagen");
}

}
</script>

</body>
</html>
